# EP - Design de Software
# Equipe: Rafael Pascarelli Niccheri
# Data: 18/10/2020

import random
import time
import math as mt
import os

FICHAS=100

class Jogador():                            #Cria jogador para conseguir implemantar as rehras avançadas
    def __init__(self, numero_chamada):
        self.valor_aposta=0                 #qunatidade de fichas que o jogador aposta
        self.escolha_aposta=0               #em quem o jogadpr aposta (jigador=1, banca=2, empate=3)
        self.cartas_jogador=[]              #cartas do jogador
        self.fichas=FICHAS                  #numero de fichas do jogador
        self.numero_chamada=numero_chamada  #numero que o jogador equivale
        
    def aposta(self, valor, escolha):       #definir as apostas do jogador
        self.valor_aposta=valor
        self.escolha_aposta=escolha
        
    def adiciona_carta(self, carta):        #adiciona uma cata na mão do jogador
        self.cartas_jogador.append(carta)
        
    def soma_cartas(self):
        cartas={'A':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':0, 'J':0,'Q':0,'K':0}     #valores de cada carta
        soma=0                              #soma dos cartas
        for carta in self.cartas_jogador:   #verifica as cartas
            soma+=cartas[carta]             #atualiza a soma
        while soma >= 10:                   #verifica a soma
            soma-=10
        return soma
    
class Baralho():                            #cria os baralhos
    def __init__(self, num_baralho):
        self.num_baralho=num_baralho        #quantos baralhos serao usados
        self.numeros=['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'] * num_baralho            #cria as cartas
        self.naips=['Espadas', 'Paus', 'Ouros', 'Copas'] * len(self.numeros)        #cria os naips
        self.cartas_sorteadas=[]                        #cartas ja sorteadas
    
    def sorteia_carta(self):                                                    #sorteia cartas
        numero_sorteado=random.choice(self.numeros)                             #sorteia o valor da carta
        naip_sorteado=random.choice(self.naips)                                 #sorteia o naip da carta
        carta_sorteada=[numero_sorteado, naip_sorteado]                         #cria a carta
        if self.cartas_sorteadas.count(carta_sorteada) >= self.num_baralho:     #loop para verificar se a carta ainda esta no baralho
            return self.sorteia_carta()                                         #caso a carta nao esteja mais no baralho sorteia uma carta nova
        else:
            self.cartas_sorteadas.append(carta_sorteada)                        #adiciona a carta sorteada nas cartas ja sorteadas
            return carta_sorteada
                                               #retorna a carta sorteada
def limpa_tela():                              #limpa a tela
    os.system('cls')
    
def cria_jogadores(numero_jogadores):          #cria jogador
    jogadores=[]                               #lista de jogadpres
    for i in range(0, numero_jogadores):       #loop para criar os njogadores
        jogadores.append(Jogador(i+1))
    return jogadores

def escolher_aposta():                          #funcao para escolher em quem apostas
    escolha_aposta=int(input("Em quem voce quer apostar? "))        #input para escolher em quem apostar
    if escolha_aposta not in [1, 2, 3]:                             #loop para verificar se a escolha é valida
        print ('Escolha invalida')
        return escolher_aposta()
    else:
        return escolha_aposta

def apostar_fichas(fichas):                                         #funcao para escolher a quantidade de fichas para apostas
    fichas_apostadas=int(input("Quantois fichas quer apostar? "))   #input para escolher a quantidade de fichas para apostar
    if fichas_apostadas > fichas:                                   #loop para verificar se a quantidade de fichas é valida
        print ('Numero de fichas apostadas invalido')
        return apostar_fichas()
    else:
        return fichas_apostadas
    
def fazer_apostas(jogadores):                                       #funcao para fazer as apostas
    for jogador in jogadores:                                       #loop para todos os jogadores apostarem
        limpa_tela()
        print('Jogador', jogador.numero_chamada)
        print('Voce tem', jogador.fichas, 'fichas disponiveis')
        print('Apostas dispooniveis')
        print('1 : Jogador')
        print('2 : Banca')
        print('3 : Empate')
        escolha_aposta=escolher_aposta()
        fichas_apostadas=apostar_fichas(jogador.fichas)
        jogador.aposta(fichas_apostadas, escolha_aposta)

def valor_carta(carta):                                         #varifica o valor da carta
    cartas={'A':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':0, 'J':0,'Q':0,'K':0}
    valor=carta[0]
    return cartas[valor]

def terceira_carta_banca(jogadores, banca, baralhos):           #define se a banca recebera uma terceira carta
    if banca.soma_cartas() > 5:                                 #regras para a terceira carta da banca
        return False
    if len(jogadores[0].cartas_jogador) < 3 and banca.soma_cartas() < 6:    #regras para a terceira carta da banca
        return True
    if len(jogadores[0].cartas_jogador) == 3 and banca.soma_cartas() < 6:   #regras para a terceira carta da banca
        tabela=[[0, 1, 2, 3], [0, 1, 2, 3], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5], [0, 1, 2], [0, 1, 2, 3]]
        terceira_carta_jogador= jogadores[0].cartas_jogador[2]
        if banca.soma_cartas() in tabela[terceira_carta_jogador]:
            return True

def distribui_cartas(jogadores, banca, baralhos):               #distribui as cartas para os jogadores e para a banca
    carta1=baralhos.sorteia_carta()                             #sorteia a primeira carta dos jogadores
    carta2=baralhos.sorteia_carta()                             #sorteia a segunda carta dos jogadores
    for jogador in jogadores:
        jogador.adiciona_carta(carta1)                          #entrega a primeira carta sorteada dos jogadores para eles
        jogador.adiciona_carta(carta2)                          #entrega a segunda carta sorteada dos jogadores para eles
    carta1=baralhos.sorteia_carta()                             #sorteia a primeira carta da banca
    carta2=baralhos.sorteia_carta()                             #sorteia a segunda carta da banca
    banca.adiciona_carta(carta1)                                #entrega a primeira carta sorteada da banca para ela
    banca.adiciona_carta(carta2)                                #entrega a segunda carta sorteada da banca para ela
    if jogadores[0].soma_cartas() < 6 and banca.soma_cartas() != 8 and banca.soma_cartas() != 9:    #verifica se os jogadores devem receber uma terceira carta
        carta3=baralhos.sorteia_carta()                         #sortei a terceira carta dos jogadores se necessario
        for jogador in jogadores:
            jogador.adiciona_carta(carta3)                      #entrega a terceira carta dos jogadores para eles caso ela tenha sido sorteada
    if terceira_carta_banca(jogadores, banca, baralhos) == True: #chama a funcao que verifica se a banca deve receber uma terceira carta
        carta3=baralhos.sorteia_carta()                         #sorteia a terceira carta da banca se necessario
        banca.adiciona_carta(carta3)                            #entrega a terceira carta da banca para ela caso ela tenha sido sorteada
    
def menu(jogadores, banca, baralhos):                           #funcao que diz as informacoes dos jogadores e da as opções de apostas
    limpa_tela()
    for jogador in jogadores:
        print('O Jogador', jogador.numero_chamada, 'tem', jogador.fichas, 'fichas')
    input('Pressione enter para começar as aposta')
    fazer_apostas(jogadores)                                    #chama a funcao para fazer as apostas
